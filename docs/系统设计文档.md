# å¾·å·æ‰‘å…‹ç³»ç»Ÿè®¾è®¡æ–‡æ¡£ï¼ˆç°é‡‘èµ›æ¨¡å¼ï¼‰

## ç›®å½•
1. [é¡¹ç›®æ¦‚è¿°](#1-é¡¹ç›®æ¦‚è¿°)
2. [ç³»ç»Ÿæ¶æ„](#2-ç³»ç»Ÿæ¶æ„)
3. [æ ¸å¿ƒæ¨¡å—è®¾è®¡](#3-æ ¸å¿ƒæ¨¡å—è®¾è®¡)
4. [æ•°æ®åº“è®¾è®¡](#4-æ•°æ®åº“è®¾è®¡)
5. [å¼€å‘é˜¶æ®µè§„åˆ’](#5-å¼€å‘é˜¶æ®µè§„åˆ’)
6. [æŠ€æœ¯å®ç°ç»†èŠ‚](#6-æŠ€æœ¯å®ç°ç»†èŠ‚)
7. [å…³é”®ç®—æ³•](#7-å…³é”®ç®—æ³•)

---

## 1. é¡¹ç›®æ¦‚è¿°

### 1.1 é¡¹ç›®èƒŒæ™¯
å¼€å‘ä¸€ä¸ªåŸºäºSpring Boot + React.jsçš„å¾·å·æ‰‘å…‹ç°é‡‘èµ›ç³»ç»Ÿï¼Œæ”¯æŒä¿±ä¹éƒ¨ç®¡ç†ã€èµ›å­£åˆ¶åº¦ã€å®æ—¶æ¸¸æˆå’Œç»Ÿè®¡åŠŸèƒ½ã€‚

### 1.2 æ ¸å¿ƒç‰¹æ€§
- **ç°é‡‘èµ›æ¨¡å¼**ï¼šç­¹ç ç­‰äºçœŸå®è´§å¸ï¼Œå›ºå®šç›²æ³¨ï¼Œéšæ—¶ä¹°å…¥/ç¦»å¼€
- **èµ›å­£åˆ¶åº¦**ï¼šæŒ‰æ—¶é—´å‘¨æœŸç»„ç»‡æ¯”èµ›ï¼Œç»Ÿè®¡é•¿æœŸç›ˆäº
- **ä¿±ä¹éƒ¨ç®¡ç†**ï¼šå¤šä¿±ä¹éƒ¨æ”¯æŒï¼Œæˆå‘˜æƒé™ç®¡ç†
- **å®æ—¶æ¸¸æˆ**ï¼šWebSocketå®æ—¶é€šä¿¡ï¼Œå…¬å¹³å‘ç‰Œç®—æ³•
- **æ•°æ®ç»Ÿè®¡**ï¼šè¯¦ç»†çš„ä¸ªäººå’Œä¿±ä¹éƒ¨ç»Ÿè®¡æ•°æ®

### 1.3 æŠ€æœ¯æ ˆ
- **åç«¯**ï¼šJava 17, Spring Boot 3.2, Spring Data JPA, MySQL 8.0, Liquibase
- **å‰ç«¯**ï¼šReact 18, WebSocket, CSS3
- **æ•°æ®åº“**ï¼šMySQL 8.0
- **æ„å»ºå·¥å…·**ï¼šMaven, npm

---

## 2. ç³»ç»Ÿæ¶æ„

### 2.1 æ•´ä½“æ¶æ„
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Reactå‰ç«¯     â”‚â—„â”€â”€â–ºâ”‚  Spring Boot    â”‚â—„â”€â”€â–ºâ”‚     MySQL       â”‚
â”‚                 â”‚    â”‚     åç«¯        â”‚    â”‚     æ•°æ®åº“      â”‚
â”‚  - æ¸¸æˆç•Œé¢     â”‚    â”‚  - REST API     â”‚    â”‚  - ä¸šåŠ¡æ•°æ®     â”‚
â”‚  - ç®¡ç†ç•Œé¢     â”‚    â”‚  - WebSocket    â”‚    â”‚  - ç»Ÿè®¡æ•°æ®     â”‚
â”‚  - ç»Ÿè®¡æŠ¥è¡¨     â”‚    â”‚  - æ¸¸æˆé€»è¾‘     â”‚    â”‚  - ç”¨æˆ·æ•°æ®     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ä¸šåŠ¡å±‚æ¬¡ç»“æ„
```
ä¿±ä¹éƒ¨ï¼ˆClubï¼‰
  â†“
èµ›å­£ï¼ˆSeasonï¼‰
  â†“
ç°é‡‘èµ›æ¡Œï¼ˆCash Tableï¼‰
  â†“
æ¸¸æˆå±€ï¼ˆGame/Handï¼‰
  â†“
ç©å®¶è¡ŒåŠ¨ï¼ˆPlayer Actionsï¼‰
  â†“
ç»“ç®—ï¼ˆSettlementï¼‰
```

---

## 3. æ ¸å¿ƒæ¨¡å—è®¾è®¡

### 3.1 ä¿±ä¹éƒ¨ç®¡ç†æ¨¡å—

**åŠŸèƒ½èŒè´£ï¼š**
- ä¿±ä¹éƒ¨åˆ›å»ºä¸é…ç½®
- æˆå‘˜é‚€è¯·ä¸æƒé™ç®¡ç†
- ä¿±ä¹éƒ¨è®¾ç½®ç®¡ç†

**æ ¸å¿ƒå®ä½“ï¼š**
- `Club`ï¼šä¿±ä¹éƒ¨åŸºæœ¬ä¿¡æ¯
- `ClubMember`ï¼šæˆå‘˜å…³ç³»å’Œæƒé™
- `ClubSettings`ï¼šä¿±ä¹éƒ¨é…ç½®

**ä¸»è¦æ¥å£ï¼š**
```java
@RestController
@RequestMapping("/api/clubs")
public class ClubController {
    POST /api/clubs - åˆ›å»ºä¿±ä¹éƒ¨
    GET /api/clubs/{id} - è·å–ä¿±ä¹éƒ¨è¯¦æƒ…
    POST /api/clubs/{id}/members - é‚€è¯·æˆå‘˜
    DELETE /api/clubs/{id}/members/{userId} - ç§»é™¤æˆå‘˜
}
```

### 3.2 èµ›å­£ç®¡ç†æ¨¡å—

**åŠŸèƒ½èŒè´£ï¼š**
- èµ›å­£åˆ›å»ºä¸æ—¶é—´ç®¡ç†
- èµ›å­£å†…èµ›äº‹ç»„ç»‡
- èµ›å­£ç»Ÿè®¡æ•°æ®æ±‡æ€»

**æ ¸å¿ƒå®ä½“ï¼š**
- `Season`ï¼šèµ›å­£åŸºæœ¬ä¿¡æ¯å’Œæ—¶é—´èŒƒå›´
- `SeasonStats`ï¼šèµ›å­£ç»Ÿè®¡æ•°æ®

**ä¸šåŠ¡è§„åˆ™ï¼š**
- èµ›å­£æœ‰æ˜ç¡®çš„å¼€å§‹å’Œç»“æŸæ—¶é—´
- ä¸€ä¸ªä¿±ä¹éƒ¨å¯ä»¥æœ‰å¤šä¸ªèµ›å­£ï¼ˆå†å²èµ›å­£ï¼‰
- èµ›å­£ç»“æŸåæ•°æ®å½’æ¡£ï¼Œä¸å¯ä¿®æ”¹

### 3.3 ç°é‡‘èµ›æ¡Œç®¡ç†æ¨¡å— â­

**åŠŸèƒ½èŒè´£ï¼š**
- èµ›äº‹åˆ›å»ºä¸é…ç½®ï¼ˆç›²æ³¨ã€ä¹°å…¥èŒƒå›´ã€æ—¶é•¿ï¼‰
- ç©å®¶åº§ä½ç®¡ç†
- ç­¹ç ä¹°å…¥/è¡¥å……/å…‘ç°
- èµ›äº‹æ—¶é—´æ§åˆ¶

**æ ¸å¿ƒå®ä½“ï¼š**
- `CashTable`ï¼šç°é‡‘èµ›æ¡Œé…ç½®å’ŒçŠ¶æ€
- `TablePlayer`ï¼šæ¡Œä¸Šç©å®¶ä¿¡æ¯
- `ChipTransaction`ï¼šç­¹ç äº¤æ˜“è®°å½•

**å…³é”®ä¸šåŠ¡é€»è¾‘ï¼š**
```java
// ä¹°å…¥éªŒè¯
public boolean validateBuyin(long amount, long minBuyin, long maxBuyin) {
    return amount >= minBuyin && amount <= maxBuyin;
}

// è¡¥å……ç­¹ç éªŒè¯
public boolean validateAddChips(long currentChips, long addAmount, long maxBuyin) {
    return (currentChips + addAmount) <= maxBuyin;
}

// ç¦»æ¡Œç»“ç®—
public CashoutResult cashout(TablePlayer player) {
    long netProfit = player.getCurrentChips() - player.getTotalBuyin();
    // æ›´æ–°èµ›å­£ç»Ÿè®¡
    updateSeasonStats(player, netProfit);
    return new CashoutResult(player.getCurrentChips(), netProfit);
}
```

### 3.4 æ¸¸æˆæ ¸å¿ƒæ¨¡å— â­â­

**åŠŸèƒ½èŒè´£ï¼š**
- å…¬å¹³éšæœºå‘ç‰Œ
- æ¸¸æˆçŠ¶æ€ç®¡ç†
- ä¸‹æ³¨è½®æ¬¡æ§åˆ¶
- ç‰Œå‹è¯†åˆ«ä¸æ¯”è¾ƒ
- åº•æ± è®¡ç®—ä¸åˆ†é…

**æ ¸å¿ƒå®ä½“ï¼š**
- `Game`ï¼šå•å±€æ¸¸æˆä¿¡æ¯
- `GamePlayer`ï¼šæ¸¸æˆä¸­çš„ç©å®¶çŠ¶æ€
- `PlayerAction`ï¼šç©å®¶è¡ŒåŠ¨è®°å½•
- `Deck`ï¼šç‰Œåº“å’Œå‘ç‰Œé€»è¾‘
- `Card`ï¼šæ‰‘å…‹ç‰Œ

**æ¸¸æˆçŠ¶æ€æœºï¼š**
```
WAITING â†’ DEALING â†’ PRE_FLOP â†’ FLOP â†’ TURN â†’ RIVER â†’ SHOWDOWN â†’ FINISHED
```

**å¾·å·æ‰‘å…‹è§„åˆ™å®ç°ï¼š**

1. **å‘ç‰Œè§„åˆ™**
   - 52å¼ æ ‡å‡†æ‰‘å…‹ç‰Œ
   - Fisher-Yatesæ´—ç‰Œç®—æ³•
   - æ¯äºº2å¼ åº•ç‰Œ + 5å¼ å…¬å…±ç‰Œ
   - å‘ç‰Œå‰çƒ§ç‰Œï¼ˆBurn Cardï¼‰

2. **ä¸‹æ³¨è§„åˆ™**
   - ç›²æ³¨ï¼šå°ç›²ã€å¤§ç›²ï¼ˆå›ºå®šé‡‘é¢ï¼‰
   - ç©å®¶æ“ä½œï¼šå¼ƒç‰Œã€è¿‡ç‰Œã€è·Ÿæ³¨ã€ä¸‹æ³¨ã€åŠ æ³¨ã€å…¨ä¸‹
   - æœ€å°åŠ æ³¨ï¼šç­‰äºä¸Šä¸€æ¬¡ä¸‹æ³¨/åŠ æ³¨é‡‘é¢
   - åº•æ± ç®¡ç†ï¼šä¸»æ± ã€è¾¹æ± ï¼ˆAll-inæƒ…å†µï¼‰

3. **ç‰Œå‹è§„åˆ™ï¼ˆä»å¤§åˆ°å°ï¼‰**
   ```
   1. çš‡å®¶åŒèŠ±é¡º (Royal Flush)      - Aâ™ Kâ™ Qâ™ Jâ™ 10â™ 
   2. åŒèŠ±é¡º (Straight Flush)       - 9â™¥8â™¥7â™¥6â™¥5â™¥
   3. å››æ¡ (Four of a Kind)         - Aâ™ Aâ™¥Aâ™¦Aâ™£Kâ™ 
   4. è‘«èŠ¦ (Full House)             - Kâ™ Kâ™¥Kâ™¦5â™ 5â™¥
   5. åŒèŠ± (Flush)                  - Aâ™ Jâ™ 9â™ 6â™ 3â™ 
   6. é¡ºå­ (Straight)               - Aâ™ Kâ™¥Qâ™¦Jâ™ 10â™¥
   7. ä¸‰æ¡ (Three of a Kind)        - Qâ™ Qâ™¥Qâ™¦Aâ™ Kâ™¥
   8. ä¸¤å¯¹ (Two Pair)               - Aâ™ Aâ™¥Kâ™ Kâ™¦Qâ™ 
   9. ä¸€å¯¹ (One Pair)               - Aâ™ Aâ™¥Kâ™ Qâ™¦Jâ™ 
   10. é«˜ç‰Œ (High Card)             - Aâ™ Kâ™¥Qâ™¦Jâ™ 9â™¥
   ```

### 3.5 ç»Ÿè®¡åˆ†ææ¨¡å—

**åŠŸèƒ½èŒè´£ï¼š**
- å®æ—¶ç»Ÿè®¡æ•°æ®è®¡ç®—
- å†å²æ•°æ®åˆ†æ
- æ’è¡Œæ¦œç”Ÿæˆ
- æŠ¥è¡¨å¯¼å‡º

**ç»Ÿè®¡ç»´åº¦ï¼š**
- **ä¸ªäººç»Ÿè®¡**ï¼šèƒœç‡ã€ç›ˆäºã€VP$IPã€PFRç­‰ä¸“ä¸šæŒ‡æ ‡
- **èµ›å­£ç»Ÿè®¡**ï¼šèµ›å­£ç›ˆäºæ’è¡Œã€å‚ä¸åº¦ç»Ÿè®¡
- **ä¿±ä¹éƒ¨ç»Ÿè®¡**ï¼šæ•´ä½“æ´»è·ƒåº¦ã€æˆå‘˜è¡¨ç°

---

## 4. æ•°æ®åº“è®¾è®¡

### 4.1 æ ¸å¿ƒè¡¨ç»“æ„

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    avatar_url VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- ä¿±ä¹éƒ¨è¡¨
CREATE TABLE clubs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    avatar_url VARCHAR(255),
    creator_id BIGINT NOT NULL,
    settings JSON,  -- ä¿±ä¹éƒ¨é…ç½®
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (creator_id) REFERENCES users(id)
);

-- ä¿±ä¹éƒ¨æˆå‘˜è¡¨
CREATE TABLE club_members (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    club_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    role VARCHAR(20) NOT NULL,  -- ADMIN, MEMBER
    status VARCHAR(20) DEFAULT 'ACTIVE',  -- ACTIVE, INACTIVE
    joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (club_id) REFERENCES clubs(id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    UNIQUE KEY unique_club_user (club_id, user_id)
);

-- èµ›å­£è¡¨
CREATE TABLE seasons (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    club_id BIGINT NOT NULL,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    start_time TIMESTAMP NOT NULL,
    end_time TIMESTAMP NOT NULL,
    status VARCHAR(20) DEFAULT 'UPCOMING',  -- UPCOMING, ACTIVE, FINISHED
    settings JSON,  -- èµ›å­£é…ç½®
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (club_id) REFERENCES clubs(id)
);

-- ç°é‡‘èµ›æ¡Œè¡¨
CREATE TABLE cash_tables (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    season_id BIGINT NOT NULL,
    name VARCHAR(100) NOT NULL,
    small_blind INT NOT NULL,
    big_blind INT NOT NULL,
    min_buyin BIGINT NOT NULL,
    max_buyin BIGINT NOT NULL,
    max_seats INT DEFAULT 6,
    duration_minutes INT,  -- èµ›äº‹æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
    status VARCHAR(20) DEFAULT 'WAITING',  -- WAITING, RUNNING, FINISHED, CANCELLED
    start_time TIMESTAMP,
    end_time TIMESTAMP,
    scheduled_end_time TIMESTAMP,  -- è®¡åˆ’ç»“æŸæ—¶é—´
    created_by BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (season_id) REFERENCES seasons(id),
    FOREIGN KEY (created_by) REFERENCES users(id)
);

-- æ¡Œä¸Šç©å®¶è¡¨
CREATE TABLE table_players (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    table_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    seat_position INT NOT NULL,  -- 1-9åº§ä½å·
    total_buyin BIGINT DEFAULT 0,  -- æ€»ä¹°å…¥é‡‘é¢
    current_chips BIGINT NOT NULL,  -- å½“å‰ç­¹ç 
    status VARCHAR(20) DEFAULT 'PLAYING',  -- PLAYING, LEFT, SITTING_OUT
    joined_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    left_at TIMESTAMP,
    FOREIGN KEY (table_id) REFERENCES cash_tables(id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    UNIQUE KEY unique_table_seat (table_id, seat_position),
    UNIQUE KEY unique_table_user (table_id, user_id)
);

-- ç­¹ç äº¤æ˜“è®°å½•è¡¨
CREATE TABLE chip_transactions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    table_player_id BIGINT NOT NULL,
    type VARCHAR(20) NOT NULL,  -- BUYIN, ADDON, CASHOUT
    amount BIGINT NOT NULL,
    balance_before BIGINT NOT NULL,
    balance_after BIGINT NOT NULL,
    description VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (table_player_id) REFERENCES table_players(id)
);

-- æ¸¸æˆå±€è¡¨
CREATE TABLE games (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    table_id BIGINT NOT NULL,
    hand_number INT NOT NULL,  -- ç¬¬å‡ å±€ï¼ˆä»1å¼€å§‹ï¼‰
    button_position INT NOT NULL,  -- åº„å®¶ä½ç½®
    small_blind_amount INT NOT NULL,
    big_blind_amount INT NOT NULL,
    status VARCHAR(20) DEFAULT 'DEALING',  -- DEALING, PRE_FLOP, FLOP, TURN, RIVER, SHOWDOWN, FINISHED
    deck_seed VARCHAR(255),  -- æ´—ç‰Œç§å­ï¼ˆå¯éªŒè¯éšæœºæ€§ï¼‰
    community_cards VARCHAR(20),  -- å…¬å…±ç‰Œï¼Œå¦‚"AS,KH,QD,JC,10S"
    total_pot BIGINT DEFAULT 0,
    rake_amount BIGINT DEFAULT 0,  -- æŠ½æ°´
    winner_seats VARCHAR(50),  -- è·èƒœåº§ä½ï¼Œå¦‚"1,3"ï¼ˆå¹³åˆ†æƒ…å†µï¼‰
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    finished_at TIMESTAMP,
    FOREIGN KEY (table_id) REFERENCES cash_tables(id)
);

-- æ¸¸æˆå±€ç©å®¶è¡¨
CREATE TABLE game_players (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    game_id BIGINT NOT NULL,
    table_player_id BIGINT NOT NULL,
    seat_position INT NOT NULL,
    hole_cards VARCHAR(10),  -- åº•ç‰Œï¼ˆåŠ å¯†å­˜å‚¨ï¼‰ï¼Œå¦‚"AS,KH"
    chips_before BIGINT NOT NULL,  -- æœ¬å±€å¼€å§‹å‰ç­¹ç 
    chips_after BIGINT NOT NULL,  -- æœ¬å±€ç»“æŸåç­¹ç 
    total_bet BIGINT DEFAULT 0,  -- æœ¬å±€æ€»ä¸‹æ³¨
    net_win BIGINT DEFAULT 0,  -- æœ¬å±€å‡€ç›ˆäº
    final_action VARCHAR(20),  -- æœ€ç»ˆè¡ŒåŠ¨ï¼šFOLD, CALL, RAISE, ALLIN, WIN_BY_FOLD
    hand_strength VARCHAR(50),  -- æœ€ç»ˆç‰Œå‹ï¼Œå¦‚"PAIR_ACES"
    is_winner BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (game_id) REFERENCES games(id),
    FOREIGN KEY (table_player_id) REFERENCES table_players(id)
);

-- ç©å®¶è¡ŒåŠ¨è®°å½•è¡¨
CREATE TABLE player_actions (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    game_id BIGINT NOT NULL,
    game_player_id BIGINT NOT NULL,
    round VARCHAR(20) NOT NULL,  -- PRE_FLOP, FLOP, TURN, RIVER
    action_type VARCHAR(20) NOT NULL,  -- FOLD, CHECK, CALL, BET, RAISE, ALLIN
    amount BIGINT DEFAULT 0,  -- ä¸‹æ³¨é‡‘é¢
    pot_before BIGINT NOT NULL,  -- è¡ŒåŠ¨å‰åº•æ± 
    pot_after BIGINT NOT NULL,  -- è¡ŒåŠ¨ååº•æ± 
    position INT NOT NULL,  -- è¡ŒåŠ¨é¡ºåº
    time_taken_seconds INT,  -- æ€è€ƒæ—¶é—´
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (game_id) REFERENCES games(id),
    FOREIGN KEY (game_player_id) REFERENCES game_players(id)
);

-- èµ›å­£ç»Ÿè®¡è¡¨
CREATE TABLE season_stats (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    season_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    -- åŸºç¡€æ•°æ®
    total_buyin BIGINT DEFAULT 0,  -- æ€»ä¹°å…¥
    total_cashout BIGINT DEFAULT 0,  -- æ€»å…‘ç°
    net_profit BIGINT DEFAULT 0,  -- å‡€ç›ˆäº
    -- å‚ä¸æ•°æ®
    sessions_played INT DEFAULT 0,  -- å‚ä¸èµ›äº‹æ•°
    hands_played INT DEFAULT 0,  -- å‚ä¸å±€æ•°
    total_time_minutes INT DEFAULT 0,  -- æ€»æ¸¸æˆæ—¶é—´
    -- æ¸¸æˆæ•°æ®
    hands_won INT DEFAULT 0,  -- èµ¢çš„å±€æ•°
    biggest_win BIGINT DEFAULT 0,  -- æœ€å¤§å•å±€ç›ˆåˆ©
    biggest_loss BIGINT DEFAULT 0,  -- æœ€å¤§å•å±€äºæŸ
    -- ä¸“ä¸šæŒ‡æ ‡
    vpip_percentage DECIMAL(5,2) DEFAULT 0,  -- è‡ªæ„¿æŠ•å…¥åº•æ± ç™¾åˆ†æ¯”
    pfr_percentage DECIMAL(5,2) DEFAULT 0,  -- ç¿»ç‰Œå‰åŠ æ³¨ç‡
    aggression_factor DECIMAL(5,2) DEFAULT 0,  -- æ¿€è¿›å› å­
    -- æ—¶é—´æˆ³
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (season_id) REFERENCES seasons(id),
    FOREIGN KEY (user_id) REFERENCES users(id),
    UNIQUE KEY unique_season_user (season_id, user_id)
);
```

### 4.2 ç´¢å¼•è®¾è®¡

```sql
-- æ€§èƒ½ä¼˜åŒ–ç´¢å¼•
CREATE INDEX idx_club_members_club_id ON club_members(club_id);
CREATE INDEX idx_club_members_user_id ON club_members(user_id);
CREATE INDEX idx_seasons_club_id ON seasons(club_id);
CREATE INDEX idx_cash_tables_season_id ON cash_tables(season_id);
CREATE INDEX idx_cash_tables_status ON cash_tables(status);
CREATE INDEX idx_table_players_table_id ON table_players(table_id);
CREATE INDEX idx_table_players_user_id ON table_players(user_id);
CREATE INDEX idx_games_table_id ON games(table_id);
CREATE INDEX idx_games_created_at ON games(created_at);
CREATE INDEX idx_game_players_game_id ON game_players(game_id);
CREATE INDEX idx_player_actions_game_id ON player_actions(game_id);
CREATE INDEX idx_season_stats_season_id ON season_stats(season_id);
CREATE INDEX idx_season_stats_user_id ON season_stats(user_id);
```

---

## 5. å¼€å‘é˜¶æ®µè§„åˆ’

### ğŸ¯ ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒå‘ç‰ŒåŠŸèƒ½ï¼ˆWeek 1-2ï¼‰

**ç›®æ ‡ï¼š** å®ç°å¯éªŒè¯çš„å…¬å¹³éšæœºå‘ç‰Œç³»ç»Ÿ

**æŠ€æœ¯è¦ç‚¹ï¼š**
- Fisher-Yatesæ´—ç‰Œç®—æ³•
- SecureRandoméšæœºæ•°ç”Ÿæˆ
- ç‰Œå‹è¯†åˆ«ç®—æ³•
- å‰ç«¯æ‰‘å…‹ç‰Œç»„ä»¶

**äº¤ä»˜ç‰©ï¼š**
- âœ… 52å¼ ç‰Œçš„æ ‡å‡†ç‰Œåº“
- âœ… æ´—ç‰Œå’Œå‘ç‰Œé€»è¾‘
- âœ… å‰ç«¯ç‰Œæ¡Œç•Œé¢
- âœ… å‘ç‰ŒåŠ¨ç”»æ•ˆæœ
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–

**è¯¦ç»†ä»»åŠ¡ï¼š**

**Day 1-2: æ•°æ®åº“åŸºç¡€**
```sql
-- Liquibase changeset
CREATE TABLE games (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    table_id BIGINT,
    hand_number INT,
    button_position INT,
    deck_seed VARCHAR(255),
    community_cards VARCHAR(20),
    status VARCHAR(20),
    created_at TIMESTAMP
);

CREATE TABLE game_players (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    game_id BIGINT,
    seat_position INT,
    hole_cards VARCHAR(10),
    chips_before BIGINT,
    chips_after BIGINT
);
```

**Day 3-5: åç«¯æ ¸å¿ƒç±»**
```java
// æ‰‘å…‹ç‰Œæšä¸¾
public enum Suit {
    SPADE("â™ "), HEART("â™¥"), CLUB("â™£"), DIAMOND("â™¦");
}

public enum Rank {
    TWO(2), THREE(3), FOUR(4), FIVE(5), SIX(6), SEVEN(7), EIGHT(8),
    NINE(9), TEN(10), JACK(11), QUEEN(12), KING(13), ACE(14);
}

// æ‰‘å…‹ç‰Œç±»
public class Card {
    private final Suit suit;
    private final Rank rank;
    
    public String getDisplayName() {
        return rank.getSymbol() + suit.getSymbol();
    }
}

// ç‰Œåº“ç±»
public class Deck {
    private List<Card> cards;
    private SecureRandom random;
    
    public void shuffle() {
        // Fisher-Yatesæ´—ç‰Œç®—æ³•
        for (int i = cards.size() - 1; i > 0; i--) {
            int j = random.nextInt(i + 1);
            Collections.swap(cards, i, j);
        }
    }
    
    public Card dealCard() {
        if (cards.isEmpty()) {
            throw new IllegalStateException("ç‰Œåº“å·²ç©º");
        }
        return cards.remove(0);
    }
}

// æ¸¸æˆç±»
@Entity
public class Game {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;
    
    private Long tableId;
    private int handNumber;
    private int buttonPosition;
    private String deckSeed;  // æ´—ç‰Œç§å­
    private String communityCards;  // JSONæ ¼å¼å­˜å‚¨
    
    @Enumerated(EnumType.STRING)
    private GameStatus status;
    
    @OneToMany(mappedBy = "game", cascade = CascadeType.ALL)
    private List<GamePlayer> players;
}
```

**Day 6-8: å‰ç«¯ç»„ä»¶**
```javascript
// æ‰‘å…‹ç‰Œç»„ä»¶
const Card = ({ suit, rank, isHidden = false }) => {
  const suitSymbols = {
    'SPADE': 'â™ ', 'HEART': 'â™¥', 'CLUB': 'â™£', 'DIAMOND': 'â™¦'
  };
  
  const isRed = suit === 'HEART' || suit === 'DIAMOND';
  
  return (
    <div className={`card ${isRed ? 'red' : 'black'} ${isHidden ? 'hidden' : ''}`}>
      {!isHidden && (
        <>
          <span className="rank">{rank}</span>
          <span className="suit">{suitSymbols[suit]}</span>
        </>
      )}
    </div>
  );
};

// ç‰Œæ¡Œç»„ä»¶
const PokerTable = () => {
  const [communityCards, setCommunityCards] = useState([]);
  const [players, setPlayers] = useState([]);
  
  return (
    <div className="poker-table">
      <div className="community-area">
        <h3>å…¬å…±ç‰Œ</h3>
        <div className="community-cards">
          {communityCards.map((card, index) => (
            <Card key={index} {...card} />
          ))}
        </div>
      </div>
      
      <div className="players-area">
        {players.map(player => (
          <PlayerSeat key={player.id} player={player} />
        ))}
      </div>
    </div>
  );
};
```

**Day 9-10: æµ‹è¯•ä¸é›†æˆ**
```java
@Test
public void testShuffleRandomness() {
    Deck deck1 = new Deck();
    Deck deck2 = new Deck();
    
    deck1.shuffle();
    deck2.shuffle();
    
    // éªŒè¯ä¸¤æ¬¡æ´—ç‰Œç»“æœä¸åŒ
    assertNotEquals(deck1.getCards(), deck2.getCards());
}

@Test
public void testDealCards() {
    Deck deck = new Deck();
    deck.shuffle();
    
    // å‘2å¼ åº•ç‰Œç»™6ä¸ªç©å®¶
    for (int i = 0; i < 6; i++) {
        Card card1 = deck.dealCard();
        Card card2 = deck.dealCard();
        assertNotNull(card1);
        assertNotNull(card2);
        assertNotEquals(card1, card2);
    }
    
    // éªŒè¯å‰©ä½™ç‰Œæ•°
    assertEquals(40, deck.getRemainingCards());
}
```

---

### ğŸ¯ ç¬¬äºŒé˜¶æ®µï¼šç»“ç®—åŠŸèƒ½ï¼ˆWeek 3-4ï¼‰

**ç›®æ ‡ï¼š** å®ç°å®Œæ•´çš„ç‰Œå‹è¯†åˆ«å’Œç»“ç®—ç³»ç»Ÿ

**æŠ€æœ¯è¦ç‚¹ï¼š**
- ç‰Œå‹è¯†åˆ«ç®—æ³•ï¼ˆä»7å¼ ç‰Œä¸­é€‰æœ€ä½³5å¼ ï¼‰
- ç‰Œå‹æ¯”è¾ƒé€»è¾‘
- åº•æ± åˆ†é…ç®—æ³•
- è¾¹æ± å¤„ç†ï¼ˆAll-inæƒ…å†µï¼‰

**æ ¸å¿ƒç®—æ³•ï¼š**
```java
// ç‰Œå‹è¯†åˆ«
public class HandEvaluator {
    
    public HandRank evaluateHand(List<Card> allCards) {
        // ä»7å¼ ç‰Œä¸­é€‰æ‹©æœ€ä½³5å¼ ç‰Œç»„åˆ
        List<List<Card>> combinations = generateCombinations(allCards, 5);
        HandRank bestHand = null;
        
        for (List<Card> combo : combinations) {
            HandRank hand = evaluateFiveCards(combo);
            if (bestHand == null || hand.compareTo(bestHand) > 0) {
                bestHand = hand;
            }
        }
        return bestHand;
    }
    
    private HandRank evaluateFiveCards(List<Card> cards) {
        if (isRoyalFlush(cards)) return new HandRank(ROYAL_FLUSH, cards);
        if (isStraightFlush(cards)) return new HandRank(STRAIGHT_FLUSH, cards);
        if (isFourOfAKind(cards)) return new HandRank(FOUR_OF_A_KIND, cards);
        if (isFullHouse(cards)) return new HandRank(FULL_HOUSE, cards);
        if (isFlush(cards)) return new HandRank(FLUSH, cards);
        if (isStraight(cards)) return new HandRank(STRAIGHT, cards);
        if (isThreeOfAKind(cards)) return new HandRank(THREE_OF_A_KIND, cards);
        if (isTwoPair(cards)) return new HandRank(TWO_PAIR, cards);
        if (isOnePair(cards)) return new HandRank(ONE_PAIR, cards);
        return new HandRank(HIGH_CARD, cards);
    }
}

// åº•æ± åˆ†é…
public class PotManager {
    
    public List<PotResult> distributePots(List<GamePlayer> players, long totalPot) {
        List<PotResult> results = new ArrayList<>();
        
        // æŒ‰æŠ•å…¥ç­¹ç æ’åºï¼Œå¤„ç†è¾¹æ± 
        players.sort(Comparator.comparing(GamePlayer::getTotalBet));
        
        long remainingPot = totalPot;
        int eligiblePlayers = players.size();
        
        for (int i = 0; i < players.size(); i++) {
            GamePlayer player = players.get(i);
            long playerBet = player.getTotalBet();
            
            if (i > 0) {
                long prevBet = players.get(i - 1).getTotalBet();
                playerBet -= prevBet;
            }
            
            long sidePot = playerBet * eligiblePlayers;
            
            // æ‰¾å‡ºè¯¥è¾¹æ± çš„è·èƒœè€…
            List<GamePlayer> eligibleForThisPot = players.subList(i, players.size());
            List<GamePlayer> winners = findWinners(eligibleForThisPot);
            
            // åˆ†é…è¾¹æ± 
            long winPerPlayer = sidePot / winners.size();
            for (GamePlayer winner : winners) {
                results.add(new PotResult(winner, winPerPlayer));
            }
            
            remainingPot -= sidePot;
            eligiblePlayers--;
        }
        
        return results;
    }
}
```

---

### ğŸ¯ ç¬¬ä¸‰é˜¶æ®µï¼šç‰Œå±€ç®¡ç†ï¼ˆWeek 5-6ï¼‰

**ç›®æ ‡ï¼š** å®ç°å®Œæ•´çš„æ¸¸æˆæµç¨‹æ§åˆ¶

**æŠ€æœ¯è¦ç‚¹ï¼š**
- æ¸¸æˆçŠ¶æ€æœº
- ä¸‹æ³¨è½®æ¬¡ç®¡ç†
- ç©å®¶æ“ä½œéªŒè¯
- WebSocketå®æ—¶é€šä¿¡

**çŠ¶æ€æœºå®ç°ï¼š**
```java
@Component
public class GameStateMachine {
    
    public void processPlayerAction(Long gameId, Long playerId, PlayerAction action) {
        Game game = gameRepository.findById(gameId);
        
        // éªŒè¯æ“ä½œåˆæ³•æ€§
        validateAction(game, playerId, action);
        
        // æ‰§è¡Œæ“ä½œ
        executeAction(game, playerId, action);
        
        // æ£€æŸ¥æ˜¯å¦éœ€è¦çŠ¶æ€è½¬æ¢
        checkStateTransition(game);
        
        // å¹¿æ’­çŠ¶æ€æ›´æ–°
        broadcastGameState(game);
    }
    
    private void checkStateTransition(Game game) {
        switch (game.getStatus()) {
            case PRE_FLOP:
                if (allPlayersActed(game)) {
                    dealFlop(game);
                    game.setStatus(GameStatus.FLOP);
                }
                break;
            case FLOP:
                if (allPlayersActed(game)) {
                    dealTurn(game);
                    game.setStatus(GameStatus.TURN);
                }
                break;
            // ... å…¶ä»–çŠ¶æ€è½¬æ¢
        }
    }
}
```

---

### ğŸ¯ ç¬¬å››é˜¶æ®µï¼šèµ›äº‹ç®¡ç†ï¼ˆWeek 7-8ï¼‰

**ç›®æ ‡ï¼š** å®ç°ç°é‡‘èµ›æ¡Œçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ

**æŠ€æœ¯è¦ç‚¹ï¼š**
- èµ›äº‹åˆ›å»ºä¸é…ç½®
- ç©å®¶ä¹°å…¥/è¡¥å……/ç¦»æ¡Œ
- æ—¶é—´æ§åˆ¶ä¸è‡ªåŠ¨ç»“æŸ
- ç­¹ç äº¤æ˜“è®°å½•

**æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼š**
```java
@Service
public class CashTableService {
    
    public CashTable createTable(CreateTableRequest request) {
        // éªŒè¯åˆ›å»ºæƒé™
        validateCreatePermission(request.getCreatorId(), request.getSeasonId());
        
        CashTable table = new CashTable();
        table.setSeasonId(request.getSeasonId());
        table.setName(request.getName());
        table.setSmallBlind(request.getSmallBlind());
        table.setBigBlind(request.getBigBlind());
        table.setMinBuyin(request.getMinBuyin());
        table.setMaxBuyin(request.getMaxBuyin());
        table.setDurationMinutes(request.getDurationMinutes());
        table.setStatus(TableStatus.WAITING);
        
        return cashTableRepository.save(table);
    }
    
    public TablePlayer joinTable(Long tableId, Long userId, long buyinAmount) {
        CashTable table = findById(tableId);
        
        // éªŒè¯ä¹°å…¥é‡‘é¢
        if (buyinAmount < table.getMinBuyin() || buyinAmount > table.getMaxBuyin()) {
            throw new IllegalArgumentException("ä¹°å…¥é‡‘é¢ä¸åœ¨å…è®¸èŒƒå›´å†…");
        }
        
        // æ£€æŸ¥åº§ä½
        int availableSeat = findAvailableSeat(tableId);
        if (availableSeat == -1) {
            throw new IllegalStateException("æ²¡æœ‰å¯ç”¨åº§ä½");
        }
        
        // åˆ›å»ºç©å®¶è®°å½•
        TablePlayer player = new TablePlayer();
        player.setTableId(tableId);
        player.setUserId(userId);
        player.setSeatPosition(availableSeat);
        player.setTotalBuyin(buyinAmount);
        player.setCurrentChips(buyinAmount);
        player.setStatus(PlayerStatus.PLAYING);
        
        TablePlayer savedPlayer = tablePlayerRepository.save(player);
        
        // è®°å½•ä¹°å…¥äº¤æ˜“
        recordTransaction(savedPlayer.getId(), TransactionType.BUYIN, buyinAmount, 0, buyinAmount);
        
        return savedPlayer;
    }
    
    @Scheduled(fixedRate = 60000)  // æ¯åˆ†é’Ÿæ£€æŸ¥
    public void checkTableTimeouts() {
        List<CashTable> runningTables = cashTableRepository.findByStatus(TableStatus.RUNNING);
        
        for (CashTable table : runningTables) {
            if (LocalDateTime.now().isAfter(table.getScheduledEndTime())) {
                endTable(table.getId());
            }
        }
    }
}
```

---

### ğŸ¯ ç¬¬äº”é˜¶æ®µï¼šä¿±ä¹éƒ¨ç®¡ç†ï¼ˆWeek 9-10ï¼‰

**ç›®æ ‡ï¼š** å®Œå–„ä¿±ä¹éƒ¨å’Œèµ›å­£ç®¡ç†åŠŸèƒ½

**æŠ€æœ¯è¦ç‚¹ï¼š**
- ä¿±ä¹éƒ¨æƒé™ç®¡ç†
- èµ›å­£åˆ›å»ºä¸é…ç½®
- æˆå‘˜é‚€è¯·ä¸å®¡æ‰¹
- æ•°æ®ç»Ÿè®¡ä¸æŠ¥è¡¨

---

### ğŸ¯ ç¬¬å…­é˜¶æ®µï¼šç»Ÿè®¡ä¸ä¼˜åŒ–ï¼ˆWeek 11-12ï¼‰

**ç›®æ ‡ï¼š** å®Œå–„ç»Ÿè®¡åŠŸèƒ½å’Œç³»ç»Ÿä¼˜åŒ–

**æŠ€æœ¯è¦ç‚¹ï¼š**
- å®æ—¶ç»Ÿè®¡è®¡ç®—
- å†å²æ•°æ®åˆ†æ
- æ€§èƒ½ä¼˜åŒ–
- å®‰å…¨åŠ å›º

---

## 6. æŠ€æœ¯å®ç°ç»†èŠ‚

### 6.1 éšæœºæ€§ä¿è¯

**æ´—ç‰Œç®—æ³•ï¼š**
```java
public class SecureDeck {
    private static final SecureRandom SECURE_RANDOM = new SecureRandom();
    
    public void shuffle(String seed) {
        // ä½¿ç”¨æ—¶é—´æˆ³ + ç”¨æˆ·æä¾›çš„ç§å­
        long timestamp = System.currentTimeMillis();
        String combinedSeed = timestamp + "_" + seed;
        
        // è®¾ç½®éšæœºç§å­
        SECURE_RANDOM.setSeed(combinedSeed.hashCode());
        
        // Fisher-Yatesæ´—ç‰Œ
        for (int i = cards.size() - 1; i > 0; i--) {
            int j = SECURE_RANDOM.nextInt(i + 1);
            Collections.swap(cards, i, j);
        }
        
        // è®°å½•ç§å­ç”¨äºéªŒè¯
        this.deckSeed = combinedSeed;
    }
}
```

### 6.2 WebSocketå®æ—¶é€šä¿¡

**åç«¯é…ç½®ï¼š**
```java
@Configuration
@EnableWebSocket
public class WebSocketConfig implements WebSocketConfigurer {
    
    @Override
    public void registerWebSocketHandlers(WebSocketHandlerRegistry registry) {
        registry.addHandler(new GameWebSocketHandler(), "/ws/game/{tableId}")
                .setAllowedOrigins("*");
    }
}

@Component
public class GameWebSocketHandler extends TextWebSocketHandler {
    
    @Override
    public void afterConnectionEstablished(WebSocketSession session) {
        String tableId = extractTableId(session);
        sessionManager.addSession(tableId, session);
    }
    
    public void broadcastToTable(Long tableId, GameStateUpdate update) {
        List<WebSocketSession> sessions = sessionManager.getTableSessions(tableId);
        String message = objectMapper.writeValueAsString(update);
        
        for (WebSocketSession session : sessions) {
            if (session.isOpen()) {
                session.sendMessage(new TextMessage(message));
            }
        }
    }
}
```

**å‰ç«¯è¿æ¥ï¼š**
```javascript
class GameWebSocket {
    constructor(tableId, onMessage) {
        this.tableId = tableId;
        this.onMessage = onMessage;
        this.connect();
    }
    
    connect() {
        this.ws = new WebSocket(`ws://localhost:8080/ws/game/${this.tableId}`);
        
        this.ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            this.onMessage(data);
        };
        
        this.ws.onclose = () => {
            // é‡è¿é€»è¾‘
            setTimeout(() => this.connect(), 3000);
        };
    }
    
    sendAction(action) {
        if (this.ws.readyState === WebSocket.OPEN) {
            this.ws.send(JSON.stringify(action));
        }
    }
}
```

### 6.3 æ•°æ®å®‰å…¨

**åº•ç‰ŒåŠ å¯†ï¼š**
```java
@Component
public class CardEncryption {
    
    @Value("${poker.card.encryption.key}")
    private String encryptionKey;
    
    public String encryptHoleCards(List<Card> cards) {
        String cardString = cards.stream()
            .map(Card::toString)
            .collect(Collectors.joining(","));
        
        return AESUtil.encrypt(cardString, encryptionKey);
    }
    
    public List<Card> decryptHoleCards(String encrypted) {
        String cardString = AESUtil.decrypt(encrypted, encryptionKey);
        return Arrays.stream(cardString.split(","))
            .map(Card::fromString)
            .collect(Collectors.toList());
    }
}
```

---

## 7. å…³é”®ç®—æ³•

### 7.1 ç‰Œå‹è¯†åˆ«ç®—æ³•

```java
public class HandRankCalculator {
    
    // å¿«é€Ÿç‰Œå‹è¯†åˆ«ï¼ˆä½¿ç”¨ä½è¿ç®—ä¼˜åŒ–ï¼‰
    public HandRank calculateHandRank(List<Card> sevenCards) {
        // è½¬æ¢ä¸ºä½è¡¨ç¤º
        long suits = 0;
        long ranks = 0;
        
        for (Card card : sevenCards) {
            suits |= (1L << (card.getSuit().ordinal() * 13 + card.getRank().getValue()));
            ranks |= (1L << card.getRank().getValue());
        }
        
        // æ£€æŸ¥åŒèŠ±
        boolean isFlush = checkFlush(suits);
        
        // æ£€æŸ¥é¡ºå­
        boolean isStraight = checkStraight(ranks);
        
        if (isFlush && isStraight) {
            return checkStraightFlush(sevenCards);
        }
        
        // æ£€æŸ¥å¯¹å­ã€ä¸‰æ¡ã€å››æ¡
        return checkPairs(sevenCards);
    }
    
    private boolean checkFlush(long suits) {
        // æ£€æŸ¥æ˜¯å¦æœ‰5å¼ æˆ–ä»¥ä¸ŠåŒèŠ±è‰²
        for (int suit = 0; suit < 4; suit++) {
            long suitMask = suits & (0x1FFFL << (suit * 13));
            if (Long.bitCount(suitMask) >= 5) {
                return true;
            }
        }
        return false;
    }
    
    private boolean checkStraight(long ranks) {
        // æ£€æŸ¥è¿ç»­5å¼ ç‰Œ
        // A-2-3-4-5 (wheel)
        if ((ranks & 0x100F) == 0x100F) return true;
        
        // å…¶ä»–é¡ºå­
        for (int i = 0; i <= 8; i++) {
            if ((ranks & (0x1F << i)) == (0x1F << i)) {
                return true;
            }
        }
        return false;
    }
}
```

### 7.2 åº•æ± åˆ†é…ç®—æ³•

```java
public class PotDistribution {
    
    public List<WinResult> distributePot(List<GamePlayer> players) {
        // æŒ‰æŠ•å…¥é‡‘é¢æ’åº
        players.sort(Comparator.comparing(GamePlayer::getTotalBet));
        
        List<SidePot> sidePots = createSidePots(players);
        List<WinResult> results = new ArrayList<>();
        
        for (SidePot pot : sidePots) {
            List<GamePlayer> winners = findWinners(pot.getEligiblePlayers());
            long winPerPlayer = pot.getAmount() / winners.size();
            long remainder = pot.getAmount() % winners.size();
            
            // åˆ†é…åº•æ± ï¼Œä½™æ•°ç»™ä½ç½®é å‰çš„ç©å®¶
            for (int i = 0; i < winners.size(); i++) {
                long winAmount = winPerPlayer + (i < remainder ? 1 : 0);
                results.add(new WinResult(winners.get(i), winAmount));
            }
        }
        
        return results;
    }
    
    private List<SidePot> createSidePots(List<GamePlayer> sortedPlayers) {
        List<SidePot> sidePots = new ArrayList<>();
        long prevBet = 0;
        
        for (int i = 0; i < sortedPlayers.size(); i++) {
            GamePlayer player = sortedPlayers.get(i);
            long currentBet = player.getTotalBet();
            long betDiff = currentBet - prevBet;
            
            if (betDiff > 0) {
                long potAmount = betDiff * (sortedPlayers.size() - i);
                List<GamePlayer> eligible = sortedPlayers.subList(i, sortedPlayers.size());
                sidePots.add(new SidePot(potAmount, eligible));
            }
            
            prevBet = currentBet;
        }
        
        return sidePots;
    }
}
```

---

## 8. éƒ¨ç½²ä¸è¿ç»´

### 8.1 ç¯å¢ƒé…ç½®

**ç”Ÿäº§ç¯å¢ƒé…ç½®ï¼š**
```yaml
# application-prod.yml
spring:
  datasource:
    url: jdbc:mysql://prod-db:3306/poker_db?useSSL=true&serverTimezone=UTC
    username: ${DB_USERNAME}
    password: ${DB_PASSWORD}
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
  
  jpa:
    hibernate:
      ddl-auto: validate
    show-sql: false
  
  liquibase:
    change-log: classpath:db/changelog/db.changelog-master.xml

poker:
  card:
    encryption:
      key: ${CARD_ENCRYPTION_KEY}
  websocket:
    allowed-origins: ${ALLOWED_ORIGINS}
  
logging:
  level:
    com.poker: INFO
    org.springframework.web: WARN
```

### 8.2 ç›‘æ§æŒ‡æ ‡

**å…³é”®ç›‘æ§æŒ‡æ ‡ï¼š**
- æ¸¸æˆå±€æ•°/å°æ—¶
- å¹³å‡æ¸¸æˆæ—¶é•¿
- WebSocketè¿æ¥æ•°
- æ•°æ®åº“è¿æ¥æ± ä½¿ç”¨ç‡
- å†…å­˜ä½¿ç”¨æƒ…å†µ
- å‘ç‰Œéšæœºæ€§éªŒè¯

---

## 9. æµ‹è¯•ç­–ç•¥

### 9.1 å•å…ƒæµ‹è¯•

**æ ¸å¿ƒç®—æ³•æµ‹è¯•ï¼š**
```java
@Test
public void testHandRankComparison() {
    // çš‡å®¶åŒèŠ±é¡º vs åŒèŠ±é¡º
    HandRank royalFlush = HandRank.royalFlush(Suit.SPADE);
    HandRank straightFlush = HandRank.straightFlush(Suit.HEART, Rank.NINE);
    
    assertTrue(royalFlush.compareTo(straightFlush) > 0);
}

@Test
public void testPotDistribution() {
    // æµ‹è¯•è¾¹æ± åˆ†é…
    List<GamePlayer> players = Arrays.asList(
        createPlayer(1, 100, HandRank.pair(Rank.ACE)),
        createPlayer(2, 50, HandRank.pair(Rank.KING)),
        createPlayer(3, 100, HandRank.pair(Rank.ACE))
    );
    
    List<WinResult> results = potDistribution.distributePot(players);
    
    // éªŒè¯åˆ†é…ç»“æœ
    assertEquals(2, results.size());
    assertEquals(75, results.get(0).getAmount()); // ä¸»æ± å¹³åˆ†
    assertEquals(75, results.get(1).getAmount());
}
```

### 9.2 é›†æˆæµ‹è¯•

**å®Œæ•´æ¸¸æˆæµç¨‹æµ‹è¯•ï¼š**
```java
@SpringBootTest
@Transactional
public class GameIntegrationTest {
    
    @Test
    public void testCompleteGameFlow() {
        // 1. åˆ›å»ºèµ›äº‹
        CashTable table = createTestTable();
        
        // 2. ç©å®¶åŠ å…¥
        List<TablePlayer> players = addPlayersToTable(table.getId(), 6);
        
        // 3. å¼€å§‹æ¸¸æˆ
        Game game = gameService.startNewGame(table.getId());
        
        // 4. æ¨¡æ‹Ÿå®Œæ•´æ¸¸æˆæµç¨‹
        simulatePreFlop(game);
        simulateFlop(game);
        simulateTurn(game);
        simulateRiver(game);
        simulateShowdown(game);
        
        // 5. éªŒè¯ç»“æœ
        Game finishedGame = gameRepository.findById(game.getId());
        assertEquals(GameStatus.FINISHED, finishedGame.getStatus());
        
        // 6. éªŒè¯ç­¹ç å˜åŒ–
        verifyChipDistribution(players, finishedGame);
    }
}
```

---

## 10. å®‰å…¨è€ƒè™‘

### 10.1 é˜²ä½œå¼Šæœºåˆ¶

1. **å‘ç‰Œå®‰å…¨**
   - ä½¿ç”¨åŠ å¯†çº§éšæœºæ•°ç”Ÿæˆå™¨
   - è®°å½•æ´—ç‰Œç§å­ï¼Œæ”¯æŒäº‹åéªŒè¯
   - åº•ç‰ŒåŠ å¯†å­˜å‚¨

2. **æ“ä½œéªŒè¯**
   - æœåŠ¡ç«¯éªŒè¯æ‰€æœ‰ç©å®¶æ“ä½œ
   - é˜²æ­¢å®¢æˆ·ç«¯ç¯¡æ”¹
   - æ“ä½œæ—¶é—´çª—å£é™åˆ¶

3. **æ•°æ®å®Œæ•´æ€§**
   - å…³é”®æ•°æ®æ•°å­—ç­¾å
   - æ¸¸æˆè®°å½•ä¸å¯ç¯¡æ”¹
   - å®šæœŸæ•°æ®ä¸€è‡´æ€§æ£€æŸ¥

### 10.2 æƒé™æ§åˆ¶

```java
@PreAuthorize("hasRole('CLUB_ADMIN') or @clubService.isMember(#clubId, authentication.name)")
public CashTable createTable(@PathVariable Long clubId, @RequestBody CreateTableRequest request) {
    // åˆ›å»ºèµ›äº‹é€»è¾‘
}

@PreAuthorize("@tableService.isPlayerInTable(#tableId, authentication.name)")
public void playerAction(@PathVariable Long tableId, @RequestBody PlayerActionRequest action) {
    // ç©å®¶æ“ä½œé€»è¾‘
}
```

---

## ç»“è¯­

æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†å¾·å·æ‰‘å…‹ç°é‡‘èµ›ç³»ç»Ÿçš„è®¾è®¡æ–¹æ¡ˆï¼Œæ¶µç›–äº†ä»æ ¸å¿ƒå‘ç‰Œç®—æ³•åˆ°å®Œæ•´ä¸šåŠ¡æµç¨‹çš„å„ä¸ªæ–¹é¢ã€‚å¼€å‘è¿‡ç¨‹ä¸­åº”ä¸¥æ ¼æŒ‰ç…§é˜¶æ®µè§„åˆ’è¿›è¡Œï¼Œç¡®ä¿æ¯ä¸ªé˜¶æ®µçš„äº¤ä»˜è´¨é‡ï¼Œä¸ºåç»­å¼€å‘å¥ å®šåšå®åŸºç¡€ã€‚

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨ï¼š**
1. âœ… ç¡®è®¤æŠ€æœ¯æ–¹æ¡ˆ
2. ğŸ¯ å¼€å§‹ç¬¬ä¸€é˜¶æ®µï¼šæ ¸å¿ƒå‘ç‰ŒåŠŸèƒ½å¼€å‘
3. ğŸ“Š å»ºç«‹é¡¹ç›®ç®¡ç†å’Œè¿›åº¦è·Ÿè¸ªæœºåˆ¶
4. ğŸ§ª åˆ¶å®šè¯¦ç»†çš„æµ‹è¯•è®¡åˆ’

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0*  
*æœ€åæ›´æ–°ï¼š2025-10-14*  
*ä½œè€…ï¼šå¼€å‘å›¢é˜Ÿ*
