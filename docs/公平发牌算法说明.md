# å¾·å·æ‰‘å…‹å…¬å¹³å‘ç‰Œç®—æ³•è¯¦è§£

## æ¦‚è¿°

ä¸ºäº†ç¡®ä¿å¾·å·æ‰‘å…‹æ¸¸æˆçš„å…¬å¹³æ€§å’Œéšæœºæ€§ï¼Œæˆ‘ä»¬å®ç°äº†ä¸€å¥—å®Œæ•´çš„å…¬å¹³å‘ç‰Œç®—æ³•ä½“ç³»ã€‚è¯¥ä½“ç³»ä»æ•°å­¦ç†è®ºã€ç®—æ³•å®ç°ã€å®‰å…¨ä¿éšœç­‰å¤šä¸ªå±‚é¢ç¡®ä¿æ¯å±€æ¸¸æˆçš„å‘ç‰Œç»“æœéƒ½æ˜¯å®Œå…¨éšæœºä¸”å¯éªŒè¯çš„ã€‚

---

## 1. æ ¸å¿ƒç®—æ³•ç»„ä»¶

### 1.1 Fisher-Yatesæ´—ç‰Œç®—æ³• â­

**ç®—æ³•åŸç†ï¼š**
Fisher-Yatesç®—æ³•æ˜¯æ•°å­¦ä¸Šè¯æ˜çš„æœ€å…¬å¹³çš„æ´—ç‰Œç®—æ³•ï¼Œç¡®ä¿æ¯ç§æ’åˆ—å‡ºç°çš„æ¦‚ç‡å®Œå…¨ç›¸ç­‰ã€‚

**æ•°å­¦ä¿è¯ï¼š**
- å¯¹äºnå¼ ç‰Œï¼Œå…±æœ‰n!ç§å¯èƒ½çš„æ’åˆ—
- æ¯ç§æ’åˆ—å‡ºç°çš„æ¦‚ç‡ = 1/n!
- å¯¹äº52å¼ ç‰Œï¼Œæ¦‚ç‡ = 1/52! â‰ˆ 1.24 Ã— 10^-68

**ç®—æ³•å®ç°ï¼š**
```java
public void shuffle() {
    // Fisher-Yatesæ´—ç‰Œç®—æ³•
    for (int i = cards.size() - 1; i > 0; i--) {
        // ä»0åˆ°iä¸­éšæœºé€‰æ‹©ä¸€ä¸ªä½ç½®
        int j = secureRandom.nextInt(i + 1);
        
        // äº¤æ¢ä½ç½®iå’Œjçš„ç‰Œ
        Collections.swap(cards, i, j);
    }
}
```

**ç®—æ³•åˆ†æï¼š**
- **æ—¶é—´å¤æ‚åº¦ï¼š** O(n) - åªéœ€éå†ä¸€æ¬¡
- **ç©ºé—´å¤æ‚åº¦ï¼š** O(1) - åŸåœ°äº¤æ¢ï¼Œä¸éœ€è¦é¢å¤–ç©ºé—´
- **éšæœºæ€§ï¼š** æ¯æ¬¡äº¤æ¢éƒ½æ˜¯ç­‰æ¦‚ç‡çš„ï¼Œç¡®ä¿æœ€ç»ˆç»“æœçš„å‡åŒ€åˆ†å¸ƒ

**ä¸ºä»€ä¹ˆé€‰æ‹©Fisher-Yatesï¼Ÿ**
1. **æ•°å­¦è¯æ˜çš„å…¬å¹³æ€§**ï¼šæ¯ç§æ’åˆ—æ¦‚ç‡ç›¸ç­‰
2. **æ•ˆç‡æœ€ä¼˜**ï¼šçº¿æ€§æ—¶é—´å¤æ‚åº¦
3. **å®ç°ç®€å•**ï¼šä¸å®¹æ˜“å‡ºé”™
4. **å¹¿æ³›è®¤å¯**ï¼šä¸šç•Œæ ‡å‡†ç®—æ³•

---

### 1.2 åˆ‡ç‰Œç®—æ³• ğŸ”€

**åˆ‡ç‰ŒåŸç†ï¼š**
åˆ‡ç‰Œæ˜¯åœ¨æ´—ç‰Œå®Œæˆåè¿›è¡Œçš„é¢å¤–éšæœºåŒ–æ­¥éª¤ï¼Œå³ä½¿æœ‰äººè®°ä½äº†æ´—ç‰Œåçš„é¡ºåºï¼Œåˆ‡ç‰Œä¹Ÿä¼šæ”¹å˜å®é™…çš„å‘ç‰Œé¡ºåºã€‚

**åˆ‡ç‰Œå®ç°ï¼š**
```java
private void cut() {
    int deckSize = cards.size();
    if (deckSize < 2) {
        return;  // ç‰Œåº“å¤ªå°ï¼Œè·³è¿‡åˆ‡ç‰Œ
    }
    
    // å®Œå…¨éšæœºçš„åˆ‡ç‰Œä½ç½®ï¼ˆ1åˆ°deckSize-1ä¹‹é—´ï¼‰
    int cutPosition = secureRandom.nextInt(deckSize - 1) + 1;
    
    // æ‰§è¡Œåˆ‡ç‰Œï¼šå°†cutPositionä¹‹åçš„ç‰Œç§»åˆ°å‰é¢
    List<Card> bottomHalf = new ArrayList<>(cards.subList(cutPosition, deckSize));
    List<Card> topHalf = new ArrayList<>(cards.subList(0, cutPosition));
    
    cards.clear();
    cards.addAll(bottomHalf);  // å…ˆæ”¾åº•éƒ¨çš„ç‰Œ
    cards.addAll(topHalf);     // å†æ”¾é¡¶éƒ¨çš„ç‰Œ
}
```

**åˆ‡ç‰Œçš„å®‰å…¨ä»·å€¼ï¼š**
1. **é˜²æ­¢è®°å¿†æ”»å‡»**ï¼šå³ä½¿æœ‰äººè®°ä½æ´—ç‰Œåçš„ç‰Œåºï¼Œåˆ‡ç‰Œä¼šæ”¹å˜å‘ç‰Œé¡ºåº
2. **å¢åŠ éšæœºå±‚æ¬¡**ï¼šåœ¨Fisher-Yatesç®—æ³•åŸºç¡€ä¸Šå¢åŠ é¢å¤–çš„éšæœºæ€§
3. **ç¬¦åˆçœŸå®è§„åˆ™**ï¼šæ¨¡æ‹ŸçœŸå®æ‰‘å…‹æ¸¸æˆçš„æ ‡å‡†æµç¨‹
4. **å¯é‡ç°éªŒè¯**ï¼šä½¿ç”¨ç›¸åŒç§å­çš„åˆ‡ç‰Œç»“æœæ˜¯ä¸€è‡´çš„

**åˆ‡ç‰Œä½ç½®é€‰æ‹©ï¼š**
- å®Œå…¨éšæœºé€‰æ‹©åˆ‡ç‰Œä½ç½®ï¼ˆ1åˆ°ç‰Œåº“å¤§å°-1ä¹‹é—´çš„ä»»æ„ä½ç½®ï¼‰
- ä¸é™åˆ¶åˆ‡ç‰ŒèŒƒå›´ï¼Œæœ€å¤§åŒ–éšæœºæ€§
- é¿å…åˆ‡åœ¨ç¬¬0å¼ ï¼ˆç­‰äºä¸åˆ‡ç‰Œï¼‰æˆ–æœ€åä¸€å¼ ï¼ˆç­‰äºä¸åˆ‡ç‰Œï¼‰
- æ¯æ¬¡æ´—ç‰Œåè‡ªåŠ¨æ‰§è¡Œåˆ‡ç‰Œ

---

### 1.3 SecureRandoméšæœºæ•°ç”Ÿæˆå™¨ ğŸ”’

**ä¸ºä»€ä¹ˆä¸ç”¨æ™®é€šRandomï¼Ÿ**

| ç‰¹æ€§ | Random | SecureRandom |
|------|--------|--------------|
| **éšæœºæ€§è´¨é‡** | ä¼ªéšæœº | åŠ å¯†çº§çœŸéšæœº |
| **å¯é¢„æµ‹æ€§** | å¯é¢„æµ‹ | ä¸å¯é¢„æµ‹ |
| **ç§å­å®‰å…¨** | ç®€å•çº¿æ€§åŒä½™ | å¤æ‚åŠ å¯†ç®—æ³• |
| **é€‚ç”¨åœºæ™¯** | ä¸€èˆ¬åº”ç”¨ | å®‰å…¨æ•æ„Ÿåº”ç”¨ |

**SecureRandomçš„ä¼˜åŠ¿ï¼š**
```java
// æ™®é€šRandom - ä¸é€‚åˆæ‰‘å…‹æ¸¸æˆ
Random random = new Random(System.currentTimeMillis());
// é—®é¢˜ï¼šç§å­å¯é¢„æµ‹ï¼Œåºåˆ—å¯é‡ç°

// SecureRandom - æ‰‘å…‹æ¸¸æˆæ ‡å‡†
SecureRandom secureRandom = new SecureRandom();
// ä¼˜åŠ¿ï¼šä½¿ç”¨æ“ä½œç³»ç»Ÿç†µæºï¼Œä¸å¯é¢„æµ‹
```

**ç†µæºæ¥æºï¼š**
- é¼ æ ‡ç§»åŠ¨è½¨è¿¹
- é”®ç›˜æ•²å‡»æ—¶é—´é—´éš”
- ç¡¬ç›˜è¯»å†™å»¶è¿Ÿ
- ç½‘ç»œåŒ…åˆ°è¾¾æ—¶é—´
- CPUæ¸©åº¦æ³¢åŠ¨

---

### 1.4 çƒ§ç‰Œæœºåˆ¶ ğŸ”¥

**çƒ§ç‰Œè§„åˆ™ï¼š**
åœ¨å¾·å·æ‰‘å…‹ä¸­ï¼Œæ¯ä¸ªå‘ç‰Œé˜¶æ®µå‰éƒ½è¦å…ˆ"çƒ§æ‰"ï¼ˆä¸¢å¼ƒï¼‰ä¸€å¼ ç‰Œï¼Œè¿™æ˜¯æ ‡å‡†çš„é˜²ä½œå¼Šæªæ–½ã€‚

**çƒ§ç‰Œæ—¶æœºï¼š**
```java
// å‘åº•ç‰Œå‰çƒ§1å¼ ç‰Œ
public Map<Integer, List<Card>> dealHoleCards(int playerCount) {
    burnCard();  // å…ˆçƒ§ç‰Œ
    // ç„¶åå‘åº•ç‰Œ...
}

// å‘ç¿»ç‰Œå‰çƒ§1å¼ ç‰Œ
public List<Card> dealFlop() {
    burnCard();  // å…ˆçƒ§ç‰Œ
    List<Card> flop = dealCards(3);
    return flop;
}

// å‘è½¬ç‰Œå‰çƒ§1å¼ ç‰Œ
public Card dealTurn() {
    burnCard();  // å…ˆçƒ§ç‰Œ
    Card turn = dealCard();
    return turn;
}

// å‘æ²³ç‰Œå‰çƒ§1å¼ ç‰Œ
public Card dealRiver() {
    burnCard();  // å…ˆçƒ§ç‰Œ
    Card river = dealCard();
    return river;
}
```

**çƒ§ç‰Œçš„ä½œç”¨ï¼š**
1. **é˜²æ­¢æ ‡è®°ç‰Œ**ï¼šå³ä½¿æœ‰äººåœ¨ç‰ŒèƒŒåšäº†æ ‡è®°ï¼Œä¹Ÿçœ‹ä¸åˆ°ä¸‹ä¸€å¼ è¦å‘çš„ç‰Œ
2. **å¢åŠ ä¸ç¡®å®šæ€§**ï¼šå‡å°‘å¯é¢„æµ‹çš„ä¿¡æ¯
3. **æ ‡å‡†è§„åˆ™**ï¼šç¬¦åˆå›½é™…å¾·å·æ‰‘å…‹è§„åˆ™
4. **å¿ƒç†æ•ˆåº”**ï¼šå¢åŠ ç©å®¶å¯¹å…¬å¹³æ€§çš„ä¿¡ä»»

**å®Œæ•´çš„å¾·å·æ‰‘å…‹å‘ç‰Œæµç¨‹ï¼š**
```
1. æ´—ç‰Œ + åˆ‡ç‰Œ
2. çƒ§1å¼ ç‰Œ â†’ å‘åº•ç‰Œï¼ˆæ¯äºº2å¼ ï¼‰
3. ä¸‹æ³¨è½®æ¬¡ï¼ˆPre-flopï¼‰
4. çƒ§1å¼ ç‰Œ â†’ å‘ç¿»ç‰Œï¼ˆ3å¼ å…¬å…±ç‰Œï¼‰
5. ä¸‹æ³¨è½®æ¬¡ï¼ˆFlopï¼‰
6. çƒ§1å¼ ç‰Œ â†’ å‘è½¬ç‰Œï¼ˆ1å¼ å…¬å…±ç‰Œï¼‰
7. ä¸‹æ³¨è½®æ¬¡ï¼ˆTurnï¼‰
8. çƒ§1å¼ ç‰Œ â†’ å‘æ²³ç‰Œï¼ˆ1å¼ å…¬å…±ç‰Œï¼‰
9. ä¸‹æ³¨è½®æ¬¡ï¼ˆRiverï¼‰
10. æ‘Šç‰Œï¼ˆShowdownï¼‰
```

**æ€»è®¡ç‰Œæ•°ä½¿ç”¨ï¼š**
- 6äººæ¸¸æˆï¼š12å¼ åº•ç‰Œ + 4å¼ çƒ§ç‰Œ + 5å¼ å…¬å…±ç‰Œ = 21å¼ 
- å‰©ä½™31å¼ ç‰Œç•™åœ¨ç‰Œåº“ä¸­

---

### 1.5 ç§å­ç®¡ç†ä¸å¯éªŒè¯æ€§ ğŸ“‹

**ç§å­ç”Ÿæˆç­–ç•¥ï¼š**
```java
// ç»„åˆç§å­ = æ—¶é—´æˆ³ + è‡ªå®šä¹‰ç§å­ + UUID
String shuffleSeed = timestamp + "_" + customSeed + "_" + UUID.randomUUID();
```

**ç§å­çš„ä½œç”¨ï¼š**
1. **å¯é‡ç°æ€§**ï¼šç›¸åŒç§å­äº§ç”Ÿç›¸åŒç»“æœ
2. **å¯éªŒè¯æ€§**ï¼šäº‹åå¯ä»¥éªŒè¯æ´—ç‰Œè¿‡ç¨‹
3. **é€æ˜åº¦**ï¼šç©å®¶å¯ä»¥å‚ä¸ç§å­ç”Ÿæˆ
4. **å®¡è®¡æ€§**ï¼šç›‘ç®¡æœºæ„å¯ä»¥æ£€æŸ¥

**éªŒè¯æœºåˆ¶ï¼š**
```java
public boolean verifyShuffleResult(String originalSeed) {
    // ä½¿ç”¨ç›¸åŒç§å­é‡æ–°æ´—ç‰Œ
    Deck verifyDeck = new Deck();
    verifyDeck.shuffle(originalSeed);
    
    // æ¯”è¾ƒç»“æœæ˜¯å¦ä¸€è‡´
    return Arrays.equals(originalCards, verifyDeck.getCards());
}
```

---

## 2. å¾·å·æ‰‘å…‹å‘ç‰Œè§„åˆ™å®ç°

### 2.1 æ ‡å‡†å‘ç‰Œæµç¨‹

**1. æ´—ç‰Œé˜¶æ®µ**
```java
deck.shuffle(playerProvidedSeed);  // å¯é€‰ï¼šç©å®¶æä¾›ç§å­
```

**2. å‘åº•ç‰Œé˜¶æ®µ**
```java
// æŒ‰é¡ºæ—¶é’ˆé¡ºåºï¼Œæ¯äººå‘2å¼ åº•ç‰Œ
// ç¬¬ä¸€è½®ï¼šæ¯äººå‘1å¼ 
// ç¬¬äºŒè½®ï¼šæ¯äººå†å‘1å¼ 
Map<Integer, List<Card>> holeCards = deck.dealHoleCards(playerCount);
```

**3. å‘å…¬å…±ç‰Œé˜¶æ®µ**
```java
// ç¿»ç‰Œï¼šçƒ§1å¼  + å‘3å¼ 
deck.burnCard();
List<Card> flop = deck.dealCards(3);

// è½¬ç‰Œï¼šçƒ§1å¼  + å‘1å¼ 
deck.burnCard();
Card turn = deck.dealCard();

// æ²³ç‰Œï¼šçƒ§1å¼  + å‘1å¼ 
deck.burnCard();
Card river = deck.dealCard();
```

### 2.2 çƒ§ç‰Œæœºåˆ¶çš„é‡è¦æ€§

**ä¸ºä»€ä¹ˆè¦çƒ§ç‰Œï¼Ÿ**
1. **é˜²æ­¢æ ‡è®°ç‰Œ**ï¼šå³ä½¿æœ‰äººæ ‡è®°äº†ç‰ŒèƒŒï¼Œä¹Ÿçœ‹ä¸åˆ°ä¸‹ä¸€å¼ å…¬å…±ç‰Œ
2. **å¢åŠ éšæœºæ€§**ï¼šå‡å°‘å¯é¢„æµ‹çš„ä¿¡æ¯
3. **æ ‡å‡†è§„åˆ™**ï¼šç¬¦åˆå›½é™…å¾·å·æ‰‘å…‹è§„åˆ™
4. **å¿ƒç†æ•ˆåº”**ï¼šå¢åŠ ç©å®¶å¯¹å…¬å¹³æ€§çš„ä¿¡ä»»

**çƒ§ç‰Œå®ç°ï¼š**
```java
public Card burnCard() {
    if (cards.isEmpty()) {
        logger.warn("å°è¯•ä»ç©ºç‰Œåº“çƒ§ç‰Œ");
        return null;
    }
    
    Card burnedCard = cards.remove(0);
    burnedCards.add(burnedCard);  // è®°å½•çƒ§æ‰çš„ç‰Œ
    
    logger.debug("çƒ§ç‰Œï¼š{}", burnedCard.getDisplayName());
    return burnedCard;
}
```

---

## 3. å®‰å…¨ä¿éšœæœºåˆ¶

### 3.1 å¤šå±‚éšæœºæ€§ä¿è¯

**ç¬¬ä¸€å±‚ï¼šç¡¬ä»¶éšæœºæ€§**
- ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„çœŸéšæœºæ•°
- åŸºäºç‰©ç†ç°è±¡çš„ä¸å¯é¢„æµ‹æ€§

**ç¬¬äºŒå±‚ï¼šç®—æ³•éšæœºæ€§**
- Fisher-Yatesç®—æ³•çš„æ•°å­¦ä¿è¯
- æ¯ç§æ’åˆ—ç­‰æ¦‚ç‡å‡ºç°

**ç¬¬ä¸‰å±‚ï¼šæ—¶é—´éšæœºæ€§**
- æ´—ç‰Œæ—¶é—´æˆ³çš„ä¸å¯é¢„æµ‹æ€§
- æ¯«ç§’çº§ç²¾åº¦å¢åŠ ç†µå€¼

**ç¬¬å››å±‚ï¼šç”¨æˆ·å‚ä¸éšæœºæ€§**
- ç©å®¶å¯æä¾›è‡ªå®šä¹‰ç§å­
- å¢åŠ å¤–éƒ¨ä¸å¯æ§å› ç´ 

### 3.2 é˜²ä½œå¼Šæœºåˆ¶

**1. åº•ç‰ŒåŠ å¯†å­˜å‚¨**
```java
// åº•ç‰Œä¸ä»¥æ˜æ–‡å­˜å‚¨ï¼Œä½¿ç”¨AESåŠ å¯†
String encryptedHoleCards = AESUtil.encrypt(
    card1.getShortName() + "," + card2.getShortName(), 
    encryptionKey
);
```

**2. æœåŠ¡ç«¯éªŒè¯**
```java
// æ‰€æœ‰å‘ç‰Œæ“ä½œéƒ½åœ¨æœåŠ¡ç«¯è¿›è¡Œ
// å®¢æˆ·ç«¯åªèƒ½æ¥æ”¶ç»“æœï¼Œæ— æ³•å½±å“è¿‡ç¨‹
public Card dealCard() {
    // æœåŠ¡ç«¯æ§åˆ¶çš„å‘ç‰Œé€»è¾‘
    Card card = cards.remove(0);
    recordDealingAction(card);  // è®°å½•å‘ç‰Œè¡Œä¸º
    return card;
}
```

**3. æ“ä½œæ—¥å¿—è®°å½•**
```java
// è®°å½•æ¯æ¬¡å‘ç‰Œæ“ä½œï¼Œç”¨äºå®¡è®¡
logger.info("å‘ç‰Œæ“ä½œ - æ¸¸æˆID:{}, ç‰Œ:{}, æ—¶é—´:{}, ç§å­:{}", 
           gameId, card.getDisplayName(), timestamp, shuffleSeed);
```

### 3.3 å¯éªŒè¯æ€§å®ç°

**1. ç§å­å…¬å¼€**
```java
// æ¸¸æˆç»“æŸåå…¬å¼€æ´—ç‰Œç§å­
public GameResult finishGame() {
    GameResult result = calculateResult();
    result.setShuffleSeed(deck.getShuffleSeed());  // å…¬å¼€ç§å­
    result.setShuffleTimestamp(deck.getShuffleTimestamp());
    return result;
}
```

**2. é‡ç°éªŒè¯**
```java
// ä»»ä½•äººéƒ½å¯ä»¥ä½¿ç”¨ç›¸åŒç§å­éªŒè¯ç»“æœ
public boolean verifyGameResult(String seed, List<Card> expectedCards) {
    Deck verifyDeck = new Deck();
    verifyDeck.shuffle(seed);
    
    List<Card> actualCards = verifyDeck.dealCards(expectedCards.size());
    return actualCards.equals(expectedCards);
}
```

**3. ç¬¬ä¸‰æ–¹å®¡è®¡**
```java
// æä¾›APIä¾›ç›‘ç®¡æœºæ„å®¡è®¡
@GetMapping("/api/audit/game/{gameId}/shuffle-verification")
public ShuffleVerificationResult verifyGameShuffle(@PathVariable Long gameId) {
    Game game = gameService.findById(gameId);
    return shuffleVerificationService.verify(game.getShuffleSeed());
}
```

---

## 4. æ€§èƒ½ä¼˜åŒ–

### 4.1 ç®—æ³•ä¼˜åŒ–

**1. é¢„åˆ†é…é›†åˆå®¹é‡**
```java
// é¿å…åŠ¨æ€æ‰©å®¹å¸¦æ¥çš„æ€§èƒ½æŸå¤±
private List<Card> cards = new ArrayList<>(52);
private List<Card> dealtCards = new ArrayList<>(52);
```

**2. å¯¹è±¡å¤ç”¨**
```java
// å¤ç”¨Cardå¯¹è±¡ï¼Œé¿å…é‡å¤åˆ›å»º
private static final Card[][] CARD_CACHE = new Card[4][13];
static {
    for (Suit suit : Suit.values()) {
        for (Rank rank : Rank.values()) {
            CARD_CACHE[suit.ordinal()][rank.ordinal()] = new Card(suit, rank);
        }
    }
}
```

**3. ä½è¿ç®—ä¼˜åŒ–**
```java
// ä½¿ç”¨ä½è¿ç®—åŠ é€ŸæŸäº›è®¡ç®—
public int getCardId() {
    return (suit.ordinal() << 4) | rank.ordinal();  // ä½è¿ç®—æ¯”ä¹˜æ³•å¿«
}
```

### 4.2 å†…å­˜ä¼˜åŒ–

**1. å»¶è¿Ÿåˆå§‹åŒ–**
```java
// åªåœ¨éœ€è¦æ—¶åˆ›å»ºå¯¹è±¡
private List<Card> burnedCards;

public void burnCard() {
    if (burnedCards == null) {
        burnedCards = new ArrayList<>();
    }
    // ...
}
```

**2. å¼±å¼•ç”¨ç¼“å­˜**
```java
// ä½¿ç”¨å¼±å¼•ç”¨ç¼“å­˜å¸¸ç”¨å¯¹è±¡
private static final Map<String, WeakReference<Deck>> deckCache = 
    new ConcurrentHashMap<>();
```

---

## 5. æµ‹è¯•ä¸éªŒè¯

### 5.1 éšæœºæ€§æµ‹è¯•

**1. å¡æ–¹æ£€éªŒ**
```java
@Test
public void testShuffleRandomness() {
    int[] cardCounts = new int[52];
    int iterations = 100000;
    
    for (int i = 0; i < iterations; i++) {
        Deck deck = new Deck();
        deck.shuffle();
        Card firstCard = deck.dealCard();
        cardCounts[firstCard.getCardId()]++;
    }
    
    // å¡æ–¹æ£€éªŒéªŒè¯åˆ†å¸ƒå‡åŒ€æ€§
    double chiSquare = calculateChiSquare(cardCounts, iterations / 52.0);
    assertTrue("æ´—ç‰Œåˆ†å¸ƒä¸å‡åŒ€", chiSquare < CRITICAL_VALUE);
}
```

**2. åºåˆ—ç›¸å…³æ€§æµ‹è¯•**
```java
@Test
public void testSequenceIndependence() {
    // æµ‹è¯•è¿ç»­å‘ç‰Œä¹‹é—´çš„ç›¸å…³æ€§
    // ç¡®ä¿å‰ä¸€å¼ ç‰Œä¸ä¼šå½±å“åä¸€å¼ ç‰Œçš„æ¦‚ç‡
}
```

### 5.2 æ€§èƒ½æµ‹è¯•

**1. æ´—ç‰Œæ€§èƒ½æµ‹è¯•**
```java
@Test
public void testShufflePerformance() {
    long startTime = System.nanoTime();
    
    for (int i = 0; i < 10000; i++) {
        Deck deck = new Deck();
        deck.shuffle();
    }
    
    long duration = System.nanoTime() - startTime;
    assertTrue("æ´—ç‰Œæ€§èƒ½ä¸è¾¾æ ‡", duration < MAX_ALLOWED_TIME);
}
```

**2. å†…å­˜ä½¿ç”¨æµ‹è¯•**
```java
@Test
public void testMemoryUsage() {
    Runtime runtime = Runtime.getRuntime();
    long beforeMemory = runtime.totalMemory() - runtime.freeMemory();
    
    // åˆ›å»ºå¤§é‡Deckå¯¹è±¡
    List<Deck> decks = new ArrayList<>();
    for (int i = 0; i < 1000; i++) {
        decks.add(new Deck());
    }
    
    long afterMemory = runtime.totalMemory() - runtime.freeMemory();
    long memoryUsed = afterMemory - beforeMemory;
    
    assertTrue("å†…å­˜ä½¿ç”¨è¿‡å¤š", memoryUsed < MAX_MEMORY_USAGE);
}
```

---

## 6. å®é™…åº”ç”¨ä¸­çš„è€ƒè™‘

### 6.1 å¹¶å‘å®‰å…¨

**é—®é¢˜ï¼š** å¤šä¸ªæ¸¸æˆåŒæ—¶è¿›è¡Œæ—¶çš„çº¿ç¨‹å®‰å…¨

**è§£å†³æ–¹æ¡ˆï¼š**
```java
@Component
@Scope("prototype")  // æ¯ä¸ªæ¸¸æˆä½¿ç”¨ç‹¬ç«‹çš„Deckå®ä¾‹
public class Deck {
    // æ¯ä¸ªDeckå®ä¾‹åªè¢«å•ä¸ªæ¸¸æˆçº¿ç¨‹ä½¿ç”¨
    // é¿å…äº†å¹¶å‘é—®é¢˜
}
```

### 6.2 å¼‚å¸¸å¤„ç†

**é—®é¢˜ï¼š** å‘ç‰Œè¿‡ç¨‹ä¸­çš„å¼‚å¸¸æƒ…å†µ

**è§£å†³æ–¹æ¡ˆï¼š**
```java
public Card dealCard() {
    try {
        if (cards.isEmpty()) {
            logger.error("ç‰Œåº“ä¸ºç©ºï¼Œæ— æ³•å‘ç‰Œ");
            throw new DeckEmptyException("ç‰Œåº“å·²ç©º");
        }
        
        Card card = cards.remove(0);
        dealtCards.add(card);
        
        // è®°å½•å‘ç‰Œæ—¥å¿—
        auditService.recordDealAction(gameId, card, System.currentTimeMillis());
        
        return card;
    } catch (Exception e) {
        logger.error("å‘ç‰Œå¼‚å¸¸", e);
        // è§¦å‘æ¸¸æˆå¼‚å¸¸å¤„ç†æµç¨‹
        gameService.handleDealingException(gameId, e);
        throw e;
    }
}
```

### 6.3 ç›‘æ§ä¸å‘Šè­¦

**å…³é”®æŒ‡æ ‡ç›‘æ§ï¼š**
```java
// å‘ç‰Œæ€§èƒ½ç›‘æ§
@Timed(name = "deck.shuffle.time", description = "æ´—ç‰Œè€—æ—¶")
public void shuffle() {
    // æ´—ç‰Œé€»è¾‘
}

// éšæœºæ€§è´¨é‡ç›‘æ§
@EventListener
public void onGameFinished(GameFinishedEvent event) {
    // æ”¶é›†éšæœºæ€§ç»Ÿè®¡æ•°æ®
    randomnessMonitor.recordShuffleResult(event.getShuffleSeed());
}
```

---

## 7. æ€»ç»“

æˆ‘ä»¬çš„å…¬å¹³å‘ç‰Œç®—æ³•ä½“ç³»é€šè¿‡ä»¥ä¸‹å‡ ä¸ªå±‚é¢ç¡®ä¿äº†æ¸¸æˆçš„å…¬å¹³æ€§ï¼š

### 7.1 æ•°å­¦å±‚é¢
- **Fisher-Yatesç®—æ³•**ï¼šæ•°å­¦è¯æ˜çš„ç­‰æ¦‚ç‡ä¿è¯
- **SecureRandom**ï¼šåŠ å¯†çº§éšæœºæ•°ç”Ÿæˆ
- **ç»Ÿè®¡æ£€éªŒ**ï¼šæŒç»­éªŒè¯éšæœºæ€§è´¨é‡

### 7.2 æŠ€æœ¯å±‚é¢
- **ç§å­ç®¡ç†**ï¼šå¯é‡ç°ã€å¯éªŒè¯çš„æ´—ç‰Œè¿‡ç¨‹
- **åŠ å¯†å­˜å‚¨**ï¼šåº•ç‰Œä¿¡æ¯å®‰å…¨ä¿æŠ¤
- **æ“ä½œæ—¥å¿—**ï¼šå®Œæ•´çš„å®¡è®¡è½¨è¿¹

### 7.3 ä¸šåŠ¡å±‚é¢
- **æ ‡å‡†è§„åˆ™**ï¼šç¬¦åˆå›½é™…å¾·å·æ‰‘å…‹è§„èŒƒ
- **é€æ˜åº¦**ï¼šç§å­å…¬å¼€ï¼Œç»“æœå¯éªŒè¯
- **ç”¨æˆ·å‚ä¸**ï¼šç©å®¶å¯å‚ä¸ç§å­ç”Ÿæˆ

### 7.4 å®‰å…¨å±‚é¢
- **é˜²ä½œå¼Š**ï¼šæœåŠ¡ç«¯æ§åˆ¶ï¼Œå®¢æˆ·ç«¯åªè¯»
- **ç›‘æ§å‘Šè­¦**ï¼šå¼‚å¸¸æ£€æµ‹å’Œå¤„ç†
- **ç¬¬ä¸‰æ–¹å®¡è®¡**ï¼šæ”¯æŒå¤–éƒ¨éªŒè¯

è¿™å¥—ç®—æ³•ä½“ç³»ä¸ä»…ç¡®ä¿äº†æŠ€æœ¯ä¸Šçš„éšæœºæ€§å’Œå…¬å¹³æ€§ï¼Œæ›´é‡è¦çš„æ˜¯å»ºç«‹äº†ç©å®¶å¯¹ç³»ç»Ÿçš„ä¿¡ä»»ï¼Œè¿™æ˜¯åœ¨çº¿æ‰‘å…‹æ¸¸æˆæˆåŠŸçš„å…³é”®å› ç´ ã€‚

---

*æ–‡æ¡£ç‰ˆæœ¬ï¼šv1.0*  
*æœ€åæ›´æ–°ï¼š2025-10-14*  
*ç›¸å…³ä»£ç ï¼šCard.java, Deck.java*
